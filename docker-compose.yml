version: '3.8'

services:
  # 1. Vue.js サービス (名前: "frontend")
  frontend:
    # 今いるディレクトリにある Dockerfile を使ってビルドする
    build: .
    # DockerfileのCMDを上書きし、Viteを自動起動させず待機状態にする
    command: sleep infinity

    # ボリューム (ローカルのコード変更をコンテナに即時反映させる)
    # node_modules はローカルと共有しない (パフォーマンスのため)
    volumes:
      - .:/app
      - /app/node_modules

    # ポート (ローカルPCの 5173 番ポートを、コンテナの 5173 番ポートに接続)
    ports:
      - '5173:5173'

    # 環境変数ファイル (ローカルの .env.development を読み込む)
    env_file:
      - ./.env.development

    environment:
      # ホスト(Mac)のSSHエージェントの場所をコンテナ内部に教える
      - SSH_AUTH_SOCK=${SSH_AUTH_SOCK}

    # コンテナの標準入力を開いたままにする (Viteサーバーの安定動作のため)
    stdin_open: true
    tty: true
